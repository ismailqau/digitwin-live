# =============================================================================
# PRODUCTION ENVIRONMENT
# =============================================================================
# This file contains production-specific settings
# NEVER commit actual production secrets to version control
# Use secret management services (GCP Secret Manager, AWS Secrets Manager, etc.)
# =============================================================================

NODE_ENV=production

# -----------------------------------------------------------------------------
# PRODUCTION SERVICES - GCP Cloud Run URLs
# -----------------------------------------------------------------------------
# Cloud Run automatically sets PORT=8080, so services bind to 0.0.0.0:8080
# These URLs will be updated by the deployment script after services are deployed
API_GATEWAY_PORT=8080
API_GATEWAY_HOST=0.0.0.0
API_GATEWAY_URL=https://api-gateway-XXXXXXXXXX-uc.a.run.app

WEBSOCKET_PORT=8080
WEBSOCKET_HOST=0.0.0.0
WEBSOCKET_URL=wss://websocket-server-XXXXXXXXXX-uc.a.run.app

FACE_PROCESSING_PORT=8080
FACE_PROCESSING_HOST=0.0.0.0
FACE_PROCESSING_URL=https://face-processing-service-XXXXXXXXXX-uc.a.run.app

# -----------------------------------------------------------------------------
# CORS - Allow all origins (for development/testing)
# -----------------------------------------------------------------------------
CORS_ORIGIN=*

# -----------------------------------------------------------------------------
# JWT - Use strong secrets from GCP Secret Manager
# -----------------------------------------------------------------------------
# These placeholders are replaced by Secret Manager at runtime
# Secrets are mounted as environment variables in Cloud Run
JWT_SECRET=${SECRET_JWT_SECRET}
REFRESH_SECRET=${SECRET_REFRESH_SECRET}
ACCESS_TOKEN_EXPIRY=15m
REFRESH_TOKEN_EXPIRY=7d

# -----------------------------------------------------------------------------
# DATABASE - Cloud SQL with Unix Socket Connection
# -----------------------------------------------------------------------------
# Cloud Run connects to Cloud SQL via Unix socket for better performance and security
# Format: /cloudsql/PROJECT:REGION:INSTANCE
DATABASE_HOST=/cloudsql/digitwinlive:us-central1:digitwinlive-db
DATABASE_PORT=5432
DATABASE_NAME=digitwinlive-db
DATABASE_USER=postgres
DATABASE_PASSWORD=${SECRET_DATABASE_PASSWORD}
DATABASE_SSL=false
# SSL not needed with Unix socket connection
DATABASE_POOL_MIN=5
DATABASE_POOL_MAX=50

# Cloud SQL Connection Name (used by Cloud Run --add-cloudsql-instances flag)
CLOUD_SQL_CONNECTION_NAME=digitwinlive:us-central1:digitwinlive-db

# Database URL with Unix socket connection
# Format: postgresql://user:pass@/dbname?host=/cloudsql/PROJECT:REGION:INSTANCE
# This will be constructed by the deployment script using DATABASE_HOST, DATABASE_USER, DATABASE_PASSWORD, and DATABASE_NAME
# DATABASE_URL=postgresql://postgres:${SECRET_DATABASE_PASSWORD}@/digitwinlive-db?host=/cloudsql/digitwinlive:us-central1:digitwinlive-db


# -----------------------------------------------------------------------------
# CACHING - PostgreSQL-based (no separate cache service needed)
# -----------------------------------------------------------------------------
ENABLE_CACHING=true
CACHE_TTL_SHORT=300
CACHE_TTL_MEDIUM=3600
CACHE_TTL_LONG=86400

# -----------------------------------------------------------------------------
# OAUTH - Production credentials
# -----------------------------------------------------------------------------
GOOGLE_CLIENT_ID=${SECRET_GOOGLE_CLIENT_ID}
GOOGLE_CLIENT_SECRET=${SECRET_GOOGLE_CLIENT_SECRET}
GOOGLE_REDIRECT_URI=https://digitwinlive.aimnovo.com/api/v1/auth/oauth/google/callback

APPLE_CLIENT_ID=com.aimnono.digitwinlive
APPLE_TEAM_ID=${SECRET_APPLE_TEAM_ID}
APPLE_KEY_ID=${SECRET_APPLE_KEY_ID}
APPLE_PRIVATE_KEY_PATH=/secrets/apple-private-key.p8
APPLE_REDIRECT_URI=https://digitwinlive.aimnovo.com/api/v1/auth/oauth/apple/callback

# -----------------------------------------------------------------------------
# AI SERVICES - Production API keys
# -----------------------------------------------------------------------------
MOCK_EXTERNAL_SERVICES=false

# Google Chirp (ASR)
GOOGLE_CHIRP_API_KEY=${SECRET_GOOGLE_CHIRP_API_KEY}
GOOGLE_CHIRP_LANGUAGE_CODE=en-US

# Gemini (LLM)
GEMINI_API_KEY=${SECRET_GEMINI_API_KEY}
GEMINI_MODEL=gemini-2.5-flash

# OpenAI
OPENAI_API_KEY=${SECRET_OPENAI_API_KEY}
OPENAI_MODEL=gpt-4-turbo-preview
OPENAI_TTS_MODEL=tts-1-hd
OPENAI_TTS_VOICE=alloy

# Groq
GROQ_API_KEY=${SECRET_GROQ_API_KEY}
GROQ_MODEL=mixtral-8x7b-32768

# -----------------------------------------------------------------------------
# VECTOR DATABASE - PostgreSQL with pgvector (uses same DATABASE_URL)
# -----------------------------------------------------------------------------
# Vector search is handled by PostgreSQL with pgvector extension
# No additional configuration needed - uses DATABASE_URL above
VECTOR_DIMENSIONS=768  # Google text-embedding-004 dimension
VECTOR_INDEX_LISTS=1000  # IVFFlat index parameter for production

# -----------------------------------------------------------------------------
# GCP - Production project
# -----------------------------------------------------------------------------
GCP_PROJECT_ID=digitwinlive
GCP_REGION=us-central1
GOOGLE_APPLICATION_CREDENTIALS=/secrets/gcp-service-account-prod.json

GCS_BUCKET_VOICE_MODELS=digitwinlive-voice-models-prod
GCS_BUCKET_FACE_MODELS=digitwinlive-face-models-prod
GCS_BUCKET_DOCUMENTS=digitwinlive-documents-prod
GCS_BUCKET_UPLOADS=digitwinlive-uploads-prod

# -----------------------------------------------------------------------------
# GPU SERVICES - Cloud Run or GKE endpoints
# -----------------------------------------------------------------------------
XTTS_SERVICE_URL=http://tts-service.default.svc.cluster.local:8000
# Or deploy as Cloud Run service if GPU not needed
XTTS_GPU_ENABLED=true

# Face Processing / Lip-Sync Service (Cloud Run)
LIPSYNC_SERVICE_URL=https://face-processing-service-yrzc7r3fcq-uc.a.run.app
LIPSYNC_MODEL=tpsm
LIPSYNC_GPU_ENABLED=true

# -----------------------------------------------------------------------------
# RATE LIMITING - Production limits
# -----------------------------------------------------------------------------
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_AUTH_MAX=5
RATE_LIMIT_UPLOAD_MAX=10

# -----------------------------------------------------------------------------
# LOGGING - Production level
# -----------------------------------------------------------------------------
LOG_LEVEL=warn
LOG_FORMAT=json
LOG_FILE_PATH=/var/log/app/app.log
LOG_ERROR_FILE_PATH=/var/log/app/error.log

# -----------------------------------------------------------------------------
# MONITORING - Production monitoring
# -----------------------------------------------------------------------------
SENTRY_DSN=${SECRET_SENTRY_DSN}
SENTRY_ENVIRONMENT=production

NEW_RELIC_LICENSE_KEY=${SECRET_NEW_RELIC_LICENSE_KEY}
NEW_RELIC_APP_NAME=digitwinlive-prod

DATADOG_API_KEY=${SECRET_DATADOG_API_KEY}
DATADOG_APP_KEY=${SECRET_DATADOG_APP_KEY}

# -----------------------------------------------------------------------------
# EMAIL - Production email service
# -----------------------------------------------------------------------------
SENDGRID_API_KEY=${SECRET_SENDGRID_API_KEY}
SMTP_FROM_EMAIL=noreply@digitwinlive.com
SMTP_FROM_NAME="DigiTwin Live"

# -----------------------------------------------------------------------------
# PAYMENT - Stripe production
# -----------------------------------------------------------------------------
STRIPE_SECRET_KEY=${SECRET_STRIPE_SECRET_KEY}
STRIPE_PUBLISHABLE_KEY=${SECRET_STRIPE_PUBLISHABLE_KEY}
STRIPE_WEBHOOK_SECRET=${SECRET_STRIPE_WEBHOOK_SECRET}

STRIPE_PRICE_ID_PRO=price_prod_pro_monthly
STRIPE_PRICE_ID_ENTERPRISE=price_prod_enterprise_monthly

# -----------------------------------------------------------------------------
# CONTENT SAFETY
# -----------------------------------------------------------------------------
PERSPECTIVE_API_KEY=${SECRET_PERSPECTIVE_API_KEY}

# -----------------------------------------------------------------------------
# FEATURE FLAGS - Production features
# -----------------------------------------------------------------------------
FEATURE_OAUTH_GOOGLE=true
FEATURE_OAUTH_APPLE=true
FEATURE_VOICE_CLONING=true
FEATURE_FACE_CLONING=true
FEATURE_VIDEO_GENERATION=true
FEATURE_ANALYTICS=true

# -----------------------------------------------------------------------------
# PRODUCTION TOOLS - Restricted
# -----------------------------------------------------------------------------
ENABLE_API_DOCS=false
ENABLE_DEBUG_ENDPOINTS=false
ENABLE_CACHING=true
ENABLE_COMPRESSION=true

# -----------------------------------------------------------------------------
# SUBSCRIPTION LIMITS - Production limits
# -----------------------------------------------------------------------------
FREE_TIER_CONVERSATION_MINUTES_PER_DAY=60
FREE_TIER_DOCUMENTS_PER_MONTH=10
FREE_TIER_VOICE_MODELS=1

PRO_TIER_CONVERSATION_MINUTES_PER_DAY=0
PRO_TIER_DOCUMENTS_PER_MONTH=100
PRO_TIER_VOICE_MODELS=5

ENTERPRISE_TIER_CONVERSATION_MINUTES_PER_DAY=0
ENTERPRISE_TIER_DOCUMENTS_PER_MONTH=0
ENTERPRISE_TIER_VOICE_MODELS=0

# -----------------------------------------------------------------------------
# SECURITY - Production Security Settings (STRICT)
# -----------------------------------------------------------------------------
# Strong password requirements for production
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SPECIAL_CHARS=true

# Session secrets from GCP Secret Manager
SESSION_SECRET=${SECRET_SESSION_SECRET}
SESSION_TIMEOUT_MINUTES=60
# 1 hour timeout for security

CSRF_SECRET=${SECRET_CSRF_SECRET}

# -----------------------------------------------------------------------------
# PERFORMANCE
# -----------------------------------------------------------------------------
CACHE_TTL_SHORT=300
CACHE_TTL_MEDIUM=3600
CACHE_TTL_LONG=86400

# -----------------------------------------------------------------------------
# ANALYTICS
# -----------------------------------------------------------------------------
GA_TRACKING_ID=${SECRET_GA_TRACKING_ID}
MIXPANEL_TOKEN=${SECRET_MIXPANEL_TOKEN}
AMPLITUDE_API_KEY=${SECRET_AMPLITUDE_API_KEY}

# -----------------------------------------------------------------------------
# WEBHOOKS
# -----------------------------------------------------------------------------
WEBHOOK_SECRET=${SECRET_WEBHOOK_SECRET}
WEBHOOK_TIMEOUT_MS=5000

# -----------------------------------------------------------------------------
# BACKUP & DISASTER RECOVERY
# -----------------------------------------------------------------------------
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *"
BACKUP_RETENTION_DAYS=30
BACKUP_STORAGE_BUCKET=digitwinlive-backups-prod

# -----------------------------------------------------------------------------
# COMPLIANCE
# -----------------------------------------------------------------------------
DATA_RETENTION_DAYS=90
AUDIT_LOG_RETENTION_DAYS=365

GDPR_ENABLED=true
GDPR_DATA_EXPORT_ENABLED=true
GDPR_RIGHT_TO_DELETION_ENABLED=true

# -----------------------------------------------------------------------------
# MOBILE APP
# -----------------------------------------------------------------------------
MOBILE_APP_VERSION=1.0.0
MOBILE_APP_BUILD_NUMBER=1
MOBILE_FORCE_UPDATE_VERSION=1.0.0

DEEP_LINK_SCHEME=digitwinlive
DEEP_LINK_HOST=app.digitwinlive.com
